<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../partials/head') %>
    <link href="/stylesheets/morris.css" rel="stylesheet" type="text/css" />
     <!-- morris chart -->
	<script src="/javascripts/morris.min.js"></script>
	<script src="/javascripts/raphael-min.js"></script>
</head>

<body class="page-header-fixed sidemenu-closed-hidelogo page-content-white page-md header-dark dark-sidebar-color logo-dark dark-theme">
    <div class="page-wrapper">
        <%- include('../partials/topbar'); %>
            <!-- start page container -->
            <div class="page-container">
                <!-- start sidebar menu -->
                <%- include('../partials/sidebar1'); %>
                    <!-- end sidebar menu -->
                    <div class="page-content-wrapper">
                        <div class="page-content">
                            <div class="page-bar">
                                <div class="page-title-breadcrumb">
                                    <div class=" pull-left">
                                        <div class="page-title">Historical Data</div>
                                    </div>
                                    <ol class="breadcrumb page-breadcrumb pull-right">
                                        <li><i class="fa fa-home"></i>&nbsp;<a class="parent-item" href="home">Home</a>&nbsp;<i class="fa fa-angle-right"></i>
                                        </li>
                                        <li class="active">Dashboard</li>
                                    </ol>
                                </div>
                            </div>
                            <!--  -->
                            <!-- start widget -->
                            <div class="row">
                                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 col-6">
                                    <div class="card">
                                        <div class="card-head">
                                            <header>Assessments</header>
                                        </div>
                                        <div class="card-body " id="chartjs_line_parent">
                                            <div class="row">
                                                <canvas id="chartjs_line"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!--  -->
                                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 col-6">
                                    <div class="card">
                                        <div class="card-head">
                                            <header>Number Of Students</header>
                                        </div>
                                        <div class="card-body " id="chartjs_pie_parent">
                                            <div class="row">
                                                <canvas id="chartjs_pie"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <!--  -->
                                   
                                    <!--  -->
                                    
                                </div>
                                <!--  -->
                            </div>
                           <!-- start bar chart -->
                            <!-- start chart -->
                            <div class="row clearfix">
                                <div class="col-lg-12 col-md-6 col-sm-12 col-xs-12 col-6">
                                    <div class="card">
                                        <div class="card-head">
                                            <header>Number Of Assessments to Performance</header>
                                        </div>
                                        <div class="card-body">
                                            <div class="recent-report__chart">
                                                <div id="chart1"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- end widget -->
                            <!--  -->
                            <!-- <h1><%= //grade %></h1> -->
                        </div>
                        <!-- end page container -->
                        <!-- start footer -->
                        <%- include('../partials/footer'); %>
                            <!-- end footer -->
                            <% var years = JSON.parse(old) 
                            var yr1=0;
                            var yr2=0;
                            var yr3=0;
                            var yr4=0;
                            var yr5=0;
                            var yr6=0;

                            var n1=0;
                            var n2=0;
                            var n3=0;
                            var n4=0;
                            var n5=0;
                            var n6=0;

                            var a1=0;
                            var a2=0;
                            var a3=0;
                            var a4=0;
                            var a5=0;
                            var a6=0;

                            for (var i = 0; i < years.length; i++){
                                if (years[i].year == 2015){
                                    yr1+=years[i].num_students;
                                    n1+=years[i].num_assessments;
                                    a1+=years[i].ave;
                                } else if (years[i].year  == 2016){
                                    yr2+=years[i].num_students;
                                    n2+=years[i].num_assessments;
                                    a2+=years[i].ave;
                                }else if (years[i].year  == 2017){
                                    yr3+=years[i].num_students;
                                    n3+=years[i].num_assessments;
                                    a3+=years[i].ave;
                                }else if (years[i].year  == 2018){
                                    yr4+=years[i].num_students;
                                    n4+=years[i].num_assessments;
                                    a4+=years[i].ave;
                                }else if (years[i].year  == 2019){
                                    yr5+=years[i].num_students;
                                    n5+=years[i].num_assessments;
                                    a5+=years[i].ave;
                                }else if (years[i].year  == 2020){
                                    yr6+=years[i].num_students;
                                    n6+=years[i].num_assessments;
                                    a6+=years[i].ave;
                                }
                            }

                            var subjects_ = JSON.parse(grade); 
                            var tot_ = 0;
                            var all= 0 ;
                            for (var i = 0; i < subjects_.length; i++){
                                tot_ += subjects_[i].got;
                                all +=subjects_[i].total;
                            }
                            %>

                            <%
                                var s = 0;
                                var body = JSON.parse(tot);
                                for (var i = 0; i < body.length; i++){
                                    students = body[i].students.split(',');
                                    for (var j = 0; j < students.length; j++){
                                        names = students[j].split(' ');
                                        s++;
                                    }
                                }
                            %>
                    </div>
                    <%- include('../partials/scripts'); %>
                    
                   
                   <script src="/javascripts/chartjs-data.js"></script>
                   <script>
                       function chart1() {
                        var options = {
                            chart: {
                            height: 350,
                            type: "bar",
                            },
                            plotOptions: {
                            bar: {
                                horizontal: false,
                                endingShape: "rounded",
                                columnWidth: "55%",
                            },
                            },
                            dataLabels: {
                            enabled: false,
                            },
                            stroke: {
                            show: true,
                            width: 2,
                            colors: ["transparent"],
                            },
                            series: [
                            {
                                name: "Student Performance",
                                data: [<%= a1 %>, <%= a2 %>, <%= a3 %>, <%= a4 %>, <%= a5 %>, <%= a6 %>, <%= (tot_/20).toFixed(0) %>],
                            },
                            {
                                name: "Number Of Assessments",
                                data: [<%= n1 %>, <%= n2 %>, <%= n3 %>, <%= n4 %>, <%= n5 %>, <%= n6 %>, <%= total_assessments %>],
                            },
                            {
                                name: "Number of Students",
                                data: [<%= (yr1/4).toFixed(0) %>, <%= (yr2/4).toFixed(0) %>, <%= (yr3/4).toFixed(0) %>, <%= (yr4/4).toFixed(0) %>, <%= (yr5/4).toFixed(0) %>, <%= (yr6/4).toFixed(0) %>, <%= s %>],
                            },
                            ],
                            xaxis: {
                            categories: [
                                "2015",
                                "2016",
                                "2017",
                                "2018",
                                "2019",
                                "2020",
                                "2021",
                            ],
                            labels: {
                                style: {
                                colors: "#9aa0ac",
                                },
                            },
                            },
                            yaxis: {
                            title: {
                                text: "Numbers",
                            },
                            labels: {
                                style: {
                                color: "#9aa0ac",
                                },
                            },
                            },
                            fill: {
                            opacity: 1,
                            },
                            tooltip: {
                            y: {
                                formatter: function (val) {
                                return val ;
                                },
                            },
                            },
                        };

                        var chart = new ApexCharts(document.querySelector("#chart1"), options);

                        chart.render();
                        }

                        $(document).ready(function() {
                        	var randomScalingFactor = function() {
                                return Math.round(Math.random() * 100);
                            };

                            var config = {
                                type: 'pie',
                            data: {
                                datasets: [{
                                    data: [
                                        <%= (yr1/4).toFixed(0) %>,
                                        <%= (yr2/4).toFixed(0) %>,
                                        <%= (yr3/4).toFixed(0) %>,
                                        <%= (yr4/4).toFixed(0) %>,
                                        <%= (yr5/4).toFixed(0) %>,
                                        <%= (yr6/4).toFixed(0) %>,
                                        <%= s %>,
                                    ],
                                    backgroundColor: [
                                        window.chartColors.red,
                                        window.chartColors.orange,
                                        window.chartColors.yellow,
                                        window.chartColors.green,
                                        window.chartColors.blue,
                                        window.chartColors.purple,
                                        window.chartColors.grey
                                    ],
                                    label: 'Dataset 1'
                                }],
                                labels: [
                                "2015",
                                "2016",
                                "2017",
                                "2018",
                                "2019",
                                "2020",
                                "2021",
                                ]
                            },
                            options: {
                                responsive: true
                            }
                        };
                        //  pie

                            var ctx = document.getElementById("chartjs_pie").getContext("2d");
                            window.myPie = new Chart(ctx, config);
                        }); 




                       $(document).ready(function() {
                        var MONTHS = ["2015", "2016", "2017", "2018", "2019", "2020", "2021"];
                        var config = {
                            type: 'line',
                            data: {
                                labels: ["2015", "2016", "2017", "2018", "2019", "2020", "2021"],
                                datasets: [{
                                    label: "Student Performance",
                                    backgroundColor: window.chartColors.red,
                                    borderColor: window.chartColors.red,
                                    data: [
                                    <%= a1 %>,
                                    <%= a2 %>,
                                    <%= a3 %>,
                                    <%= a4 %>,
                                    <%= a5 %>,
                                    <%= a6 %>,
                                    <%= (tot_/20).toFixed(0) %>
                                    ],
                                    fill: false,
                                }, {
                                    label: "Number Of Assessments",
                                    fill: false,
                                    backgroundColor: window.chartColors.blue,
                                    borderColor: window.chartColors.blue,
                                    data: [
                                    <%= n1 %>,
                                    <%= n2 %>,
                                    <%= n3 %>,
                                    <%= n4 %>,
                                    <%= n5 %>,
                                    <%= n6 %>,
                                    <%= total_assessments %>
                                    ],
                                }]
                            },
                            options: {
                                responsive: true,
                                title:{
                                    display:false,
                                    text:''
                                },
                                tooltips: {
                                    mode: 'index',
                                    intersect: false,
                                },
                                hover: {
                                    mode: 'nearest',
                                    intersect: true
                                },
                                scales: {
                                    xAxes: [{
                                        display: true,
                                        scaleLabel: {
                                            display: true,
                                            labelString: 'Year'
                                        }
                                    }],
                                    yAxes: [{
                                        display: true,
                                        scaleLabel: {
                                            display: true,
                                            labelString: 'Number'
                                        }
                                    }]
                                }
                            }
                        };
                        var ctx = document.getElementById("chartjs_line").getContext("2d");
                        window.myLine = new Chart(ctx, config);
                        });
                   </script>
                </body>
                
                </html>