<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../partials/head') %>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script>
            window.onload = function() {
                document.getElementById("online").click();
                document.getElementById("pdf").click();
            };

            setInterval(function() {
                var socket = io();
                socket.emit('assessments');
                socket.on('refresh feed', function() {
                    $("#row").load(window.location.href + " #row");
                })
            }, 5000);
        </script>
</head>

<body class="page-header-fixed sidemenu-closed-hidelogo page-content-white page-md header-dark dark-sidebar-color logo-dark dark-theme" <% if(submitted==1 ){ %> onload="alert_()"
    <% } %> >
        <!-- setting alert only if submit was a success -->
        <div class="page-wrapper">
            <%- include('../partials/topbar'); %>
                <!-- start page container -->
                <div class="page-container">
                    <!-- start sidebar menu -->
                    <%- include('../partials/sidebar'); %>
                        <!-- end sidebar menu -->
                        <div class="page-content-wrapper">
                            <div class="page-content">
                                <div class="page-bar">
                                    <div class="page-title-breadcrumb">
                                        <div class=" pull-left">
                                            <div class="page-title">Assessments</div>
                                        </div>
                                        <ol class="breadcrumb page-breadcrumb pull-right">
                                            <li><i class="fa fa-home"></i>&nbsp;<a class="parent-item" href="home">Home</a>&nbsp;<i class="fa fa-angle-right"></i>
                                            </li>
                                            <li class="active">Dashboard</li>
                                        </ol>
                                    </div>
                                </div>
                                <!--  -->
                                <!-- end pdf asessment list -->

                                <!-- start online assessment list -->
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="tabbable-line">
                                            <div class="tab-content">
                                                <div class="tab-pane active fontawesome-demo" id="tab1">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="card">
                                                                
                                                                <div class="card-body ">
                                                                    <div class="table-scrollable">
                                                                        
                                                                        <table style="border-spacing:0;"
                                                                            class="table table-striped  table-dark table-borderless table-hover table-checkable order-column borderless"
                                                                            id="example4">
                                                                            <thead >
                                                                                <tr>
                                                                                    <th>#</th>
                                                                                    <th>Subject</th>
                                                                                    <th>Assessment Name</th>
                                                                                    <td>Weighting (%)</td>
                                                                                    <th>Due Date</th>
                                                                                    <th>Count Down</th>
                                                                                    <th>Active</th>
                                                                                    <th>Start</th>
                                                                                    <th>Submit</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                <%
                                                                                s = 0;
                                                                            if (onlineAssessments.length > 2)
                                                                            {

                                                                                var body1 = JSON.parse(onlineAssessments);
                                                                                for (var i = 0; i < body1.length; i++){ 
                                                                                    s++;
                                                                                    //var dateSet = body1[i].Assessment_Date.split(' ');
                                                                                    var dateDue = body1[i].DueDate.split(' ');
                                                                                    %>
                                                                                    <tr>
                                                                                        <td><%= s %></td>
                                                                                        <td>
                                                                                            <%= body1[i].subject %>
                                                                                        </td>
                                                                                        <td>
                                                                                            <%= body1[i].name %>
                                                                                        </td>
                                                                                        <td><%= body1[i].weight %></td>
                                                                                        <td>
                                                                                            <%= `${dateDue[0]} ${dateDue[1]} ${dateDue[2]} ${dateDue[3]}` %>
                                                                                        </td>
                                                                                        <td id="count_online_<%= i %>">0d 0h 0m 0s</td>
                                                                                        <% if (body1[i].Active==1 ){%>
                                                                                            <td><h5 hidden>a</h5><a href="javascript:void(0)" class="" data-bs-toggle="tooltip" title="Edit"><i
                                                                                                    class="fa fa-check"
                                                                                                    ></i></a>
                                                                                                <a href="javascript:void(0)" class="text-inverse" title="Delete" data-bs-toggle="tooltip"></a>
                                                                                            </td>
                                                                                            <% } else{%>
                                                                                                <td><a href="javascript:void(0)" class="" data-bs-toggle="tooltip" title="Edit"><i
                                                                                                    class="fa fa-times"
                                                                                                    ></i></a>
                                                                                                    <a href="javascript:void(0)" class="text-inverse" title="Delete" data-bs-toggle="tooltip"></a>
                                                                                                </td>
                                                                                                <%}%>
                                                                                                    <td class="center">
                                                
                                                                                                        <div class="box-footer clearfix">
                                                                                                            <% if (body1[i].Active==1 ) {%>
                                                                                                                <a href="http://localhost:3000/startAssessment?aid=<%=body1[i].Assessment_id%>">
                                                                                                                    <button type="button" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect m-b-1 btn-primary">
                                                                                                        <i class="fa fa-play"></i>
                                                                                                        </button>
                                                                                                                </a>
                                                                                                                <% }%>
                                                                                                        </div>
                                                                                                    </td>
                                                                                                    <td></td>
                                                                                    </tr>
                                                                                    <!-- due date counter for online -->
                                                                                    <script>
                                                                                        var x = setInterval(function() {
                                                
                                                                                            var countDownDate = new Date(`<%= body1[i].DueDate.split(' ')[1] %> <%= body1[i].DueDate.split(' ')[2] %>, <%= body1[i].DueDate.split(' ')[3] %> 00:00:00`).getTime();
                                                                                            var now = new Date().getTime();
                                                
                                                                                            // checking the date that the assessment was set
                                                                                            var setDate = new Date(`body1[i].Assessment_Date.split(' ')[1] %> body1[i].Assessment_Date.split(' ')[2], body1[i].Assessment_Date.split(' ')[3] 00:00:00`).getTime();
                                                
                                                
                                                                                            // Find the distance between now and the count down date
                                                                                            var distance = countDownDate - now;
                                                                                            var timeline = countDownDate - setDate;
                                                
                                                                                            if ((Math.floor(setDate) + (Math.floor(timeline) / 2)) > Math.floor(now)) {
                                                                                                document.getElementById("count_online_<%= i %>").style.color = "#FFA500";
                                                                                            } else {
                                                                                                document.getElementById("count_online_<%= i %>").style.color = "#00FA9A";
                                                                                            }
                                                
                                                                                            // Time calculations for days, hours, minutes and seconds
                                                                                            var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                                                                                            var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                                            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                                                                                            var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                                                
                                                                                            // Output the result in an element with id="demo"
                                                                                            document.getElementById("count_online_<%= i %>").innerHTML = days + "d " + hours + "h " +
                                                                                                minutes + "m " + seconds + "s ";
                                                
                                                                                            // If the count down is over, write some text 
                                                                                            if (distance <= 0) {
                                                                                                clearInterval(x);
                                                                                                document.getElementById("count_online_<%= i %>").innerHTML = "0d 0h 0m 0s";
                                                                                                document.getElementById("count_online_<%= i %>").style.color = "#FF6347";
                                                                                            }
                                                                                        }, 1000);
                                                                                    </script>
                                                
                                                                                    <%
                                                                                }
                                                                                %>
                                                                                        <script>
                                                                                            var w = setInterval(function() {
                                                
                                                                                                var countDownDate = new Date(`<%= body1[body1.length - 1].DueDate.split(' ')[1] %> <%= body1[body1.length - 1].DueDate.split(' ')[2] %>, <%= body1[body1.length - 1].DueDate.split(' ')[3] %> 00:00:00`).getTime();
                                                                                                var now = new Date().getTime();
                                                
                                                                                                // checking the date that the assessment was set
                                                                                                var setDate = new Date(`body1[body1.length - 1].Assessment_Date.split(' ')[1] %> body1[body1.length - 1].Assessment_Date.split(' ')[2], body1[body1.length - 1].Assessment_Date.split(' ')[3] 00:00:00`).getTime();
                                                
                                                
                                                                                                // Find the distance between now and the count down date
                                                                                                var distance = countDownDate - now;
                                                                                                var timeline = countDownDate - setDate;
                                                
                                                                                                if ((Math.floor(setDate) + (Math.floor(timeline) / 2)) > Math.floor(now)) {
                                                                                                    document.getElementById("count_online_<%= body1.length - 1 %>").style.color = "#00FA9A";
                                                                                                } else {
                                                                                                    document.getElementById("count_online_<%= body1.length - 1 %>").style.color = "#FFA500";
                                                                                                }
                                                
                                                                                                // Time calculations for days, hours, minutes and seconds
                                                                                                var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                                                                                                var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                                                var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                                                                                                var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                                                
                                                                                                // Output the result in an element with id="demo"
                                                                                                document.getElementById("count_online_<%= body1.length - 1 %>").innerHTML = days + "d " + hours + "h " +
                                                                                                    minutes + "m " + seconds + "s ";
                                                
                                                                                                // If the count down is over, write some text 
                                                                                                if (distance <= 0) {
                                                                                                    clearInterval(w);
                                                                                                    document.getElementById("count_online_<%= body1.length - 1 %>").innerHTML = "0d 0h 0m 0s";
                                                                                                    document.getElementById("count_online_<%= body1.length - 1 %>").style.color = "#FF6347";
                                                                                                }
                                                                                            }, 1000);
                                                                                        </script>
                                                                                        <%
                                                                            }
                                                                                %>
                                                                                <!--  -->
                                                                                <!-- <tbody> -->
                                                                                    <!--  -->
                                                                                    <form action="assessments/assessments" method="post" id="submit_pdf" enctype="multipart/form-data">
                                                                                        <% 
                                                                                    if (assessments.length > 2){
                                                                                        var body = JSON.parse(assessments);
                                                                                        for (var i = 0; i < body.length; i++){ 
                                                                                            s++;
                                                                                            var dateSet = body[i].Assessment_Date.split(' ');
                                                                                            var dateDue = body[i].DueDate.split(' ');
                                                                                            %>
                                                                                            <tr>
                                                                                                <td><%= s %></td>
                                                                                                <td id="subject_<%= i %>">
                                                                                                    <%= body[i].Subject %>
                                                                                                </td>
                                                                                                <td id="teach_<%= i %>">
                                                                                                    <%= body[i].name %>
                                                                                                </td>
                                                                                                <td><%= body[i].weight %></td>
                                                                                                <td id="due_<%= i %>">
                                                                                                    <%= `${dateDue[0]} ${dateDue[1]} ${dateDue[2]} ${dateDue[3]}` %>
                                                                                                </td>
                                                                                                <td id="count_<%= i %>">
                                                                                                    <%= `${body[i].Time}` %>
                                                                                                </td>
                                                                                                <!-- due date counter start -->
                                                                                                <script>
                                                                                                    // Set the date we're counting down to
                                                                                                    // Update the count down every 1 second
                                                                                                    var x = setInterval(function() {
                                                                                                        var countDownDate = new Date(`<%= dateDue[1] %> <%= dateDue[2] %>, <%= dateDue[3] %> <%= body[i].Time %>`).getTime();
                                                                                                        var now = new Date().getTime();
                    
                                                                                                        // checking the date that the assessment was set
                                                                                                        var setDate = new Date(`<%= dateSet[1] %> <%= dateSet[2] %>, <%= dateSet[3] %> 00:00:00`).getTime();
                    
                    
                                                                                                        // Find the distance between now and the count down date
                                                                                                        var distance = countDownDate - now;
                                                                                                        var timeline = countDownDate - setDate;
                    
                                                                                                        if ((Math.floor(setDate) + (Math.floor(timeline) / 2)) > Math.floor(now)) {
                                                                                                            document.getElementById("count_<%= i %>").style.color = "#00FA9A";
                                                                                                        } else {
                                                                                                            document.getElementById("count_<%= i %>").style.color = "#FFA500";
                                                                                                        }
                    
                                                                                                        // Time calculations for days, hours, minutes and seconds
                                                                                                        var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                                                                                                        var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                                                        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                                                                                                        var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                    
                                                                                                        // Output the result in an element with id="demo"
                                                                                                        document.getElementById("count_<%= i %>").innerHTML = days + "d " + hours + "h " +
                                                                                                            minutes + "m " + seconds + "s ";
                    
                                                                                                        // If the count down is over, write some text 
                                                                                                        if (distance < 0) {
                                                                                                            clearInterval(x);
                                                                                                            document.getElementById("count_<%= i %>").innerHTML = "0d 0h 0m 0s";
                                                                                                            document.getElementById("count_<%= i %>").style.color = "#FF6347";
                                                                                                        }
                                                                                                    }, 1000);
                                                                                                </script>
                                                                                                <!-- due date counter end -->
                    
                    
                                                                                                <td >
                                                                                                    <a href="javascript:void(0)" class="" data-bs-toggle="tooltip" title="Edit">
                                                                                                        
                                                                                                        <% if (body[i].Active == 1){ %>
                                                                                                            <h5 hidden>a</h5>
                                                                                                            <i class="fa fa-check"></i></a>
                                                                                                    <% } else { %>
                                                                                                        <i class="fa fa-times"></i></a>
                                                                                                        <% } %>
                    
                                                                                                            <a href="javascript:void(0)" class="text-inverse" title="Delete" data-bs-toggle="tooltip"></a>
                                                                                                </td>
                                                                                                <td class="center">
                                                                                                    <a href="http://localhost:5000/assessments/<%= body[i].PDF_File %>" download="<%= body[i].PDF_File %>" target="_blank">
                                                                                                        <!-- <div class="box-footer clearfix"> -->
                                                                                                        <button type="button" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect m-b-1 btn-primary">
                                                                                                            <i class="fa fa-download"></i>
                                                                                                        </button>
                                                                                                        <!-- </div> -->
                                                                                                    </a>
                                                                                                </td>
                                                                                                <!-- </form> -->
                                                                                                <td class="center">
                                                                                                    <% if (body[i].Active == 1){ %>
                                                                                                        <div class="box-footer clearfix">
                                                                                                            <button type="button" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect m-b-1 btn-primary" id="btnUpload_<%= i %>" onclick="select('<%= body[i].Assessment_id %>')">
                                                                                                                <i class="fa fa-upload"></i>
                                                                                                            </button>
                                                                                                        </div>
                                                                                                        <!-- <form action="assessments/assessments" method="post" id="submit_pdf"> -->
                                                                                                        <input type="text" hidden value="" name="option" id="option">
                                                                                                        <input type="file" hidden id="upload" name="upload" accept=".pdf" multiple=false value="assessments">
                    
                    
                                                                                                        <% } %>
                                                                                                </td>
                                                                                            </tr>
                                                                                            <% } %>
                    
                                                                                    </form>
                                                                                    <script>
                                                                                        function alert_() {
                                                                                            Swal.fire(
                                                                                                'Success!',
                                                                                                'your assessment has been submitted',
                                                                                                'success'
                                                                                            );
                                                                                        }
                    
                                                                                        function select(subject) {
                                                                                            document.getElementById('upload').click();
                                                                                            // return (document.getElementById("upload").value);
                                                                                            // alert(subject);
                                                                                            document.getElementById("upload").onchange = function() {
                                                                                                // document.getElementById("submit_").submit();
                                                                                                Swal.fire({
                                                                                                    title: 'Are you sure?',
                                                                                                    text: 'old submissions for this task will be replaced!',
                                                                                                    icon: 'warning',
                                                                                                    allowOutsideClick: false,
                                                                                                    showCancelButton: true,
                                                                                                    confirmButtonText: 'Submit!',
                                                                                                    cancelButtonText: 'Cancel'
                                                                                                }).then((result) => {
                                                                                                    if (result.isConfirmed) {
                                                                                                        document.getElementById('option').value = subject;
                                                                                                        document.getElementById("submit_pdf").submit(); //submit form
                                                                                                    } else if (result.dismiss === Swal.DismissReason.cancel) {
                                                                                                        location.reload(2);
                                                                                                    };
                                                                                                })
                                                                                            };
                                                                                        }
                    
                                                                                        // Set the date we're counting down to
                                                                                        // Update the count down every 1 second
                                                                                        var z = setInterval(function() {
                    
                                                                                            var countDownDate = new Date(`<%= body[body.length - 1].DueDate.split(' ')[1] %> <%= body[body.length - 1].DueDate.split(' ')[2] %>, <%= body[body.length - 1].DueDate.split(' ')[3] %> <%= body[body.length - 1].Time %>`).getTime();
                                                                                            var now = new Date().getTime();
                    
                                                                                            // checking the date that the assessment was set
                                                                                            var setDate = new Date(`body[body.length - 1].Assessment_Date.split(' ')[1] %> body[body.length - 1].Assessment_Date.split(' ')[2], body[body.length - 1].Assessment_Date.split(' ')[3] 00:00:00`).getTime();
                    
                    
                                                                                            // Find the distance between now and the count down date
                                                                                            var distance = countDownDate - now;
                                                                                            var timeline = countDownDate - setDate;
                    
                                                                                            if ((Math.floor(setDate) + (Math.floor(timeline) / 2)) > Math.floor(now)) {
                                                                                                document.getElementById("count_<%= body.length - 1 %>").style.color = "#00FA9A";
                                                                                            } else {
                                                                                                document.getElementById("count_<%= body.length - 1 %>").style.color = "#FFA500";
                                                                                            }
                    
                                                                                            // Time calculations for days, hours, minutes and seconds
                                                                                            var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                                                                                            var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                                            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                                                                                            var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                    
                                                                                            // Output the result in an element with id="demo"
                                                                                            document.getElementById("count_<%= body.length - 1 %>").innerHTML = days + "d " + hours + "h " +
                                                                                                minutes + "m " + seconds + "s ";
                    
                                                                                            // If the count down is over, write some text 
                                                                                            if (distance < 0) {
                                                                                                clearInterval(z);
                                                                                                document.getElementById("count_<%= body.length - 1 %>").innerHTML = "0d 0h 0m 0s";
                                                                                                document.getElementById("count_<%= body.length - 1 %>").style.color = "#FF6347";
                                                                                            }
                                                                                        }, 1000);
                                                                                    </script>
                                                                                    <!--  -->
                                                                                    <% } %>
                                                                                <!--  -->
                                                                            </tbody>
                                                                        </table>
                                                                        <!-- <div class="col-md-5" style="margin-left: 30px;margin-top: 15px;">
                                                                            <a href="../assessmentMark"><button type="submit" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect m-b-10 btn-danger ">
                                                                                exit <i class="fa fa-times"></i>
                                                                            </button></a>
                                                                            
                                                                        </div> -->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                              
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- end online asessment list-->
                            </div>

                        </div>
                </div>
                <!-- end page container -->
                <!-- start footer -->
                <%- include('../partials/footer'); %>
                    <!-- end footer -->
        </div>
        <%- include('../partials/scripts'); %>
</body>

</html>